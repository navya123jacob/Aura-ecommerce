<%- include('./layouts/header.ejs') %>

<div class="container-fluid page-body-wrapper">
    <!-- partial:partials/_navbar.html -->
    <%- include('./layouts/nav.ejs') %>
    <!-- partial -->
    <div class="main-panel">
        <div class="content-wrapper">

            <div class="card">
                <div class="card-body">
                    <form class="forms-sample" method="POST" action="/admin/products/editpost?id=<%= editProduct._id %>" enctype="multipart/form-data">
                        <!-- Update the form action endpoint and set enctype accordingly -->

                        <!-- Product Name -->
                        <div class="form-group row">
                            <label for="productName" class="col-sm-3 col-form-label">Product Name</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" id="productName" name="name" placeholder="Product Name" value="<%= editProduct.name %>" required>
                                <small id="nameError" class="text-danger"></small>
                            </div>
                        </div>

                        <!-- Product Description -->
                        <div class="form-group row">
                            <label for="productDescription" class="col-sm-3 col-form-label">Product Description</label>
                            <div class="col-sm-9">
                                <textarea class="form-control" id="productDescription" name="description" placeholder="Product Description" required><%= editProduct.description %></textarea>
                                <small id="descriptionError" class="text-danger"></small>
                            </div>
                        </div>

                        <!-- Product Quantity -->
                        <div class="form-group row">
                            <label for="productQuantity" class="col-sm-3 col-form-label">Product Quantity</label>
                            <div class="col-sm-9">
                                <input type="number" class="form-control" id="productQuantity" name="quantity" placeholder="Product Quantity" value="<%= editProduct.quantity %>" required>
                                <small id="quantityError" class="text-danger"></small>
                            </div>
                        </div>

                        <!-- Product Price -->
                        <div class="form-group row">
                            <label for="productPrice" class="col-sm-3 col-form-label">Product Price</label>
                            <div class="col-sm-9">
                                <input type="number" class="form-control" id="productPrice" name="price" placeholder="Product Price" value="<%= editProduct.price %>" required>
                                <small id="priceError" class="text-danger"></small>
                            </div>
                        </div>

                        <!-- Product Images -->
                        <div class="form-group row">
                            <label for="productImages" class="col-sm-3 col-form-label">Product Images</label>
                            <div class="col-sm-9">
                                <% for (let i = 0; i < editProduct.pictures.length; i++) { %>
                                    <% let s=  editProduct.pictures[i].replace('public','') %>
                                   
                                    <div class="mb-3">
                                        <!-- Display existing image and provide option to delete -->
                                        <img src="<%= s%>" alt="Product Image" style="max-width: 100px; max-height: 100px; cursor: pointer;" onclick="selectImage('<%= i %>')">
                                        <button type="button" class="btn btn-danger btn-sm mt-2" onclick="deleteImage('<%= i %>')"><a href="/admin/products/editdelete?id=<%=editProduct._id%>&img=<%=editProduct.pictures[i]%>" class="text-white">Delete</a></button>
                                    </div>
                                <% } %>
                                <!-- Option to add new images -->
                                <input type="file" class="form-control-file mt-2" name="newImages" accept="image/*" onchange="displaySelectedNewImage(this)" multiple>
                                <small id="imagesError" class="text-danger"></small>
                            </div>
                        </div>

                        <!-- Other form fields... -->

                        <button type="submit" class="btn btn-primary mr-2" onclick="validateForm()">Submit</button>
                        <button class="btn btn-dark">Cancel</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- content-wrapper ends -->
    <!-- partial:partials/_footer.html -->
    <footer class="footer">
        <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">Aura Beauty</span>
        </div>
    </footer>
    <!-- partial -->
    </div>
    <!-- main-panel ends -->
</div>
<!-- page-body-wrapper ends -->
</div>
<!-- container-scroller -->

<%- include('./layouts/footer.ejs') %>
<script>
    function validateForm() {
        // Add validation logic if needed
    }

    function selectImage(index) {
        console.log(`Selecting image ${index}`);
        document.getElementById(`productImageInput${index}`).click();
    }

    function deleteImage(index) {
        console.log(`Deleting image ${index}`);
        // Implement logic to delete the image at the specified index
        // For example, remove the corresponding input and delete the image URL
        const imageDiv = document.querySelector(`#productImages div:nth-child(${parseInt(index) + 1})`);
        imageDiv.remove();
    }

    function displaySelectedNewImage(input) {
        // Display the selected new image
        const imagesContainer = document.querySelector("#productImages");
        const newImageDiv = document.createElement("div");
        newImageDiv.className = "mb-3";

        const newImage = document.createElement("img");
        newImage.alt = "New Product Image";
        newImage.style.maxWidth = "100px";
        newImage.style.maxHeight = "100px";
        newImage.src = URL.createObjectURL(input.files[0]);
        newImageDiv.appendChild(newImage);

        const deleteButton = document.createElement("button");
        deleteButton.type = "button";
        deleteButton.className = "btn btn-danger btn-sm mt-2";
        deleteButton.textContent = "Delete";
        deleteButton.onclick = function () {
            newImageDiv.remove();
        };
        newImageDiv.appendChild(deleteButton);

        imagesContainer.appendChild(newImageDiv);
    }
</script>
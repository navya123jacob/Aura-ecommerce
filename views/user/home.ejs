<%- include('../layouts/header') %>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
            <script src="/admin_assets/vendors/owl-carousel-2/owl.carousel.min.js"></script>

<body>
    <div class="page-wrapper">
        <header class="header header-5">
            <div class="header-middle sticky-header">
                <div class="container-fluid">
                    <div class="header-left">
                        <button class="mobile-menu-toggler">
                            <span class="sr-only">Toggle mobile menu</span>
                            <i class="icon-bars"></i>
                        </button>

                        <a href="/" class="logo">
                            <img src="/assets/images/demos/demo-5/logo.png" alt="Aura Logo" width="140" height="60">
                        </a>

                        <nav class="main-nav">
                            <ul class="menu sf-arrows">
                                <li class="megamenu-container active">
                                    <a href="/" >Home</a>
                                </li>
                                <li>
                                    <a class="sf-with-ul" href="/category">Shop</a>
                                    <ul>
                                        <% categories.forEach(category => { %>
                                            <li>
                                                <a href="/category?cat=<%= category.name %>"><%= category.name %></a>
                                            </li>
                                        <% }); %>
                                    </ul>
                                </li>
                                <li>
                                    <a href="/about" >About</a>

                                </li>
                               
                                
                               
                            </ul><!-- End .menu -->
                        </nav><!-- End .main-nav -->
                    </div><!-- End .header-left -->

                   

                    <div class="header-right">
                       
                        <a href="/wishlist" class="wishlist-link" <%= ses ? '' : 'hidden' %>>
                            <i class="icon-heart-o"></i>
                        </a>
                        
                        <div class="dropdown cart-dropdown">
                            <a href="#" class="dropdown-toggle" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-display="static">
                                <i class="fa-regular fa-user"></i>
                            </a>

                            <div class="dropdown-menu dropdown-menu-right d-flex" style="background-color:rgba(255, 255, 255, 0.5);justify-content: center;">
                      
                                <div class="dropdown-cart-action">
                                    <a href="/login" class="btn btn-outline-primary-2" <%= ses ? 'hidden' : '' %>>Login</a>
                                    <a href="/account" class="btn btn-outline-primary "   <%= ses ? '' : 'hidden' %>>Account</a>
                                    <a href="/logout" class="btn btn-outline-primary-2 "   <%= ses ? '' : 'hidden' %>>Logout</a>
                                    <a href="/register" class="btn btn-outline-primary-2" <%= ses ? 'hidden' : '' %>><span>Sign in</span><i class="icon-long-arrow-right"></i></a>

                                </div><!-- End .dropdown-cart-total -->
                                
                            </div><!-- End .dropdown-menu -->
                            <p class="greeting-message text-white mb-0" style="white-space: nowrap;">Hello <%=user%></p>
                        </div><!-- End .cart-dropdown -->

                        
                        <a href="/cart" class="wishlist-link" <%= ses ? '' : 'hidden' %>>
                            <i class="fa-solid fa-cart-shopping"></i>
                        </a>
                        
                    </div><!-- End .header-right -->
                </div><!-- End .container-fluid -->
            </div><!-- End .header-middle -->
        </header><!-- End .header -->

        <main class="main">
            <div class="intro-slider-container mb-0">
                <div class="intro-slider owl-carousel owl-theme owl-nav-inside owl-light" data-toggle="owl" data-owl-options='{"nav": true, "dots": false}'>
                    <% if (banners === null) { %>
                        <!-- Default slide -->
                        <div class="intro-slide" style="background-image: url(assets/images/demos/demo-5/slider/slide-1.jpg);">
                            <div class="container intro-content text-center">
                                <h3 class="intro-subtitle text-white">Donâ€™t Miss</h3><!-- End .h3 intro-subtitle -->
                                <h1 class="intro-title text-white">Mystery Deals</h1><!-- End .intro-title -->
                            </div><!-- End .intro-content -->
                        </div><!-- End .intro-slide -->
                    <% } else { %>
                        <% if (images.length === 0) { %>
                            <!-- No images to display, you can add a message or leave it blank -->
                            <div class="intro-slide">
                                <div class="container intro-content text-center">
                                    <p>No content available.</p>
                                </div><!-- End .intro-content -->
                            </div><!-- End .intro-slide -->
                        <% } else { %>
                            <!-- Owl Carousel initialization outside the loop -->
                            <div class="intro-slider owl-carousel owl-theme owl-nav-inside owl-light" data-toggle="owl" data-owl-options='{"nav": false, "dots": false}'>
                                <% for (let i = 0; i < banners.image.length; i++) { %>
                                
                                    <!-- Slide for each image -->
                                    
                                        <div class="intro-slide" style="background-image: url('/admin_assets/product_images/<%= images[i] %>')">
                                    
                                        <div class="container intro-content text-center">
                                            <h3 class="intro-title text-white"><%= banners.title %></h3><!-- Display title -->
                                            <a href="/category" class="btn btn-primary mt-5">SHOP</a>
                                        </div><!-- End .intro-content -->
                                    </div><!-- End .intro-slide -->
                                <% }; %>
                            </div><!-- End .intro-slider -->
                        <% } %>
                    <% } %>
                </div><!-- End .intro-slider owl-carousel owl-theme -->
                <span class="slider-loader text-white"></span><!-- End .slider-loader -->
            </div><!-- End .intro-slider-container -->
            
            <div class="brands-border owl-carousel owl-simple mb-5" data-toggle="owl" 
                data-owl-options='{
                    "nav": false, 
                    "dots": false,
                    "margin": 0,
                    "loop": false,
                    "responsive": {
                        "0": {
                            "items":2
                        },
                        "420": {
                            "items":3
                        },
                        "600": {
                            "items":4
                        },
                        "900": {
                            "items":5
                        },
                        "1024": {
                            "items":6
                        },
                        "1360": {
                            "items":7
                        }
                    }
                }'>
                <a href="#" class="brand">
                    <img src="assets/images/brands/1.png" alt="Brand Name">
                </a>

                <a href="#" class="brand">
                    <img src="assets/images/brands/2.png" alt="Brand Name">
                </a>

                <a href="#" class="brand">
                    <img src="assets/images/brands/3.png" alt="Brand Name">
                </a>

                <a href="#" class="brand">
                    <img src="assets/images/brands/4.png" alt="Brand Name">
                </a>

                <a href="#" class="brand">
                    <img src="assets/images/brands/5.png" alt="Brand Name">
                </a>

                <a href="#" class="brand">
                    <img src="assets/images/brands/6.png" alt="Brand Name">
                </a>

                <a href="#" class="brand">
                    <img src="assets/images/brands/7.png" alt="Brand Name">
                </a>
                
           </div>
                <!--  End .owl-carousel -->

            <!-- 1st row -->

            <div class="container">
                <div class="banner-group">
                    <div class="row">
                        <div class="col-md-6 d-flex" style="align-items: center;">
                            <div class="banner banner-border">
                                <a href="#">
                                    <img src="assets/images/demos/demo-5/banners/banner-1.jpg" alt="Banner">
                                </a>

                                <div class="banner-content">
                                    <!-- <h4 class="banner-subtitle"><a href="#">Trending now</a></h4>End .banner-subtitle -->
                                    <h3 class="banner-title"><a href="#"><span>Skin care</span></a></h3><!-- End .banner-title -->
                                    <% const skincareCategory = categories.find(cat => cat.name =='Skincare'); %>
                                    <a  href="<%= skincareCategory ? `/category?cat=${skincareCategory.name}` : '#' %>">Shop Now<i class="icon-long-arrow-right"></i></a>
                                </div><!-- End .banner-content -->
                            </div><!-- End .banner -->
                        </div><!-- End .col-md-6-->

                        <div class="col-md-6" >
                            <div class="banner banner-border-hover">
                                <a href="#">
                                    <img src="assets/images/demos/demo-5/banners/banner-2.jpg" alt="Banner">
                                </a>

                                <div class="banner-content">
                                    <!-- <h4 class="banner-subtitle"><a href="#">Limited time only.</a></h4>End .banner-subtitle -->
                                    <h3 class="banner-title"><a href="#"><span>Hair care</span></a></h3><!-- End .banner-title -->
                                    <% const haircareCategory = categories.find(cat => cat.name =='Haircare'); %>
                                    <a  href="<%= haircareCategory ? `/category?cat=${haircareCategory.name}` : '#' %>">Shop Now<i class="icon-long-arrow-right"></i></a>
                                </div><!-- End .banner-content -->
                            </div><!-- End .banner -->

                            <div class="banner banner-border-hover" style="object-fit: cover;">
                                <a href="#">
                                    <img src="assets/images/demos/demo-5/banners/banner-3.jpg" alt="Banner">
                                </a>

                                <div class="banner-content">
                                    <!-- <h4 class="banner-subtitle"><a href="#">This week we love...</a></h4>End .banner-subtitle -->
                                    <h3 class="banner-title "><a href="#"><span>Bath <br>& Body</span></a></h3><!-- End .banner-title -->
                                    <% const bathcareCategory = categories.find(cat => cat.name =='Bath and Body'); %>
                                    <a  href="<%= bathcareCategory ? `/category?cat=${bathcareCategory.name}` : '#' %>">Shop Now<i class="icon-long-arrow-right"></i></a>
                                </div><!-- End .banner-content -->
                            </div><!-- End .banner -->
                        </div><!-- End .col-md-6 -->
                    </div><!-- End .row -->
                </div><!-- End .banner-group -->
            </div><!-- End .container -->

           <!-- first row ends -->


            <div class="mb-4"></div><!-- End .mb-6 -->

            <div class="container">
                <div class="heading heading-center mb-3">
                    <h2 class="title">Trendy Products</h2><!-- End .title -->


                <div class="tab-content tab-content-carousel">
                    <div class="tab-pane p-0 fade show active" id="trendy-all-tab" role="tabpanel" aria-labelledby="trendy-all-link">
                        <div class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow" data-toggle="owl" 
                            data-owl-options='{
                                "nav": false, 
                                "dots": true,
                                "margin": 20,
                                "loop": false,
                                "responsive": {
                                    "0": {
                                        "items":2
                                    },
                                    "480": {
                                        "items":2
                                    },
                                    "768": {
                                        "items":3
                                    },
                                    "992": {
                                        "items":4
                                    },
                                    "1200": {
                                        "items":4,
                                        "nav": true
                                    }
                                }
                            }'>
                            <% let len=4  %>
                            <% for (let i = 0; i < Math.min(products.length, len); i++) { %>
                                <% if (products[i].quantity == 0) { %>
                                    <%len++; %>
                                    <% continue; %>
                                  <% } %>
                                <div class="product product-2">
                                    <figure class="product-media"  style="height:65%;">
                                        <% if (products[i].offername !== '') { %>
                                                
                                            <span class="product-label label-new"><%= products[i].offername %> offer</span>
                                        <% } else if (products[i].category && products[i].category.offername !== '') { %>
                                            
                                            <span class="product-label label-new"><%= products[i].category.offername %> offer</span>
                                        <% } %>
                                        <%  let s1=products[i].pictures[0].replace('public','') %>
                                        <%  let s2=products[i].pictures[1].replace('public','') %>
                                        <a href="/productdetails?id=<%=products[i]._id%>" style="display: block; height: 100%;">
                                            <img src="<%=s1 %>" alt="Product image" class="product-image" style="object-fit: cover; height: 100%;">
                                            <img src="<%= s2 %>" alt="Product image" class="product-image-hover" style="object-fit: cover; height: 100%;">
                                            <!-- You can add logic to handle multiple images if needed -->
                                        </a>
                            
                                        <div class="product-action-vertical">
                                            <button href="#" class="btn-product-icon btn-wishlist btn-expandable" title="Add to wishlist"  onclick="addtowish('<%=products[i].name%>','<%=email%>',<%=i%>)"><span id="wish<%=i%>">Add to Wishlist</span></button>
                                        </div><!-- End .product-action -->
                            
                                        <div class="product-action product-action-transparent">
                                            <button class="btn-product btn-cart" id="cart<%=i%>" onclick="addtocart('<%=products[i].name%>','<%=email%>',<%=i%>)">Add to cart</button>
                                          </div><!-- End .product-action -->
                                    </figure><!-- End .product-media -->
                            
                                    <div class="product-body">
                                        <div class="product-cat">
                                            <a href="/category?cat=<%=products[i].category.name%>"><%=products[i].category.name%></a>
                                        </div><!-- End .product-cat -->
                                        <h3 class="product-title"><a href="/productdetails?id=<%=products[i]._id%>"><%= products[i].name %></a></h3><!-- End .product-title -->
                                        <div class="product-price">
                                           <% if (products[i].offer != 0 ||products[i].category.offer!=0 ) { %>
                                                <span style="color: grey; text-decoration: line-through;">â‚¹<%= products[i].price %></span>
                                                      <span style="margin-left: 5px;">â‚¹<%= totalprice[i] %></span>
                                                  <% } else { %>
                                                      â‚¹<%= totalprice[i] %>
                                                  <% } %>
                                        </div><!-- End .product-price -->
                            
                                        <!-- Other product details can be added here -->
                                    </div><!-- End .product-body -->
                                </div><!-- End .product -->
                            <% } %>
                            
                            
                        </div><!-- End .owl-carousel -->
                    </div><!-- .End .tab-pane -->
                    <div class="tab-pane p-0 fade" id="trendy-women-tab" role="tabpanel" aria-labelledby="trendy-women-link">
                        <div class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow" data-toggle="owl" 
                            data-owl-options='{
                                "nav": false, 
                                "dots": true,
                                "margin": 20,
                                "loop": false,
                                "responsive": {
                                    "0": {
                                        "items":2
                                    },
                                    "480": {
                                        "items":2
                                    },
                                    "768": {
                                        "items":3
                                    },
                                    "992": {
                                        "items":4
                                    },
                                    "1200": {
                                        "items":4,
                                        "nav": true
                                    }
                                }
                            }'>
                        </div><!-- End .owl-carousel -->
                    </div><!-- .End .tab-pane -->
                    <div class="tab-pane p-0 fade" id="trendy-men-tab" role="tabpanel" aria-labelledby="trendy-men-link">
                        <div class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow" data-toggle="owl" 
                            data-owl-options='{
                                "nav": false, 
                                "dots": true,
                                "margin": 20,
                                "loop": false,
                                "responsive": {
                                    "0": {
                                        "items":2
                                    },
                                    "480": {
                                        "items":2
                                    },
                                    "768": {
                                        "items":3
                                    },
                                    "992": {
                                        "items":4
                                    },
                                    "1200": {
                                        "items":4,
                                        "nav": true
                                    }
                                }
                            }'>
                        </div><!-- End .owl-carousel -->
                    </div><!-- .End .tab-pane -->
                    <div class="tab-pane p-0 fade" id="trendy-access-tab" role="tabpanel" aria-labelledby="trendy-access-link">
                        <div class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow" data-toggle="owl" 
                            data-owl-options='{
                                "nav": false, 
                                "dots": true,
                                "margin": 20,
                                "loop": false,
                                "responsive": {
                                    "0": {
                                        "items":2
                                    },
                                    "480": {
                                        "items":2
                                    },
                                    "768": {
                                        "items":3
                                    },
                                    "992": {
                                        "items":4
                                    },
                                    "1200": {
                                        "items":4,
                                        "nav": true
                                    }
                                }
                            }'>
                        </div><!-- End .owl-carousel -->
                    </div><!-- .End .tab-pane -->
                </div><!-- End .tab-content -->
            </div><!-- End .container -->

          

            <div class="intro-slider-container mb-0">
                <% if (images2.length>0) { %>
                    <div class="intro-slider owl-carousel owl-theme owl-nav-inside owl-light" data-toggle="owl" data-owl-options='{"nav": false, "dots": false}'>
                        <% for (let i = 0; i < banners2.image.length; i++) { %>
                            
                            <div class="intro-slide" style="background-image: url('/admin_assets/product_images/<%= images2[i] %>');">
                                <div class="container intro-content text-center">
                                    <h3 class="intro-subtitle text-white">Explore</h3>
                                    <a href="/category" class="btn btn-primary mt-5">SHOP</a>
                                </div><!-- End .intro-content -->
                            </div><!-- End .intro-slide -->
                        <% }; %>
                    </div><!-- End .intro-slider owl-carousel owl-theme -->
                <% } else { %>
                    <!-- Your existing carousel HTML here -->
                    <div class="intro-slider owl-carousel owl-theme owl-nav-inside owl-light" data-toggle="owl" data-owl-options='{"nav": false, "dots": false}'>
                        <div class="intro-slide" style="background-image: url(assets/images/demos/demo-5/slider/sliderlast.jpg);">
                            <div class="container intro-content text-center">
                                <h3 class="intro-subtitle text-white">Explore</h3>
                                <a href="/category" class="btn btn-primary mt-5">SHOP</a>                        
                            </div><!-- End .intro-content -->
                        </div><!-- End .intro-slide -->
            
                    </div><!-- End .intro-slider owl-carousel owl-theme -->
                <% } %>
            
                <span class="slider-loader text-white"></span><!-- End .slider-loader -->
            </div><!-- End .intro-slider-container -->
            
            
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
          
            
            <script> 
            
            function addtocart(prodname,email,i)
                {
                    if (!email) {
    Swal.fire({
        title: 'Login to Purchase',
        text: 'To make a purchase, please log in.',
        icon: 'info',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Login'
    }).then((result) => {
        if (result.isConfirmed) {
            
            window.location.href = '/login';
        }
    });
}
                    const qtyValue = 1;
               
                fetch(`/productaddtocart?name=${prodname}&email=${email}&qtyValue=${qtyValue}`, {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                 },
            
        }).then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
               
                return response.json();
            })
            .then(data => {
                
                
                document.getElementById(`cart${i}`).textContent = 'Added to Cart';
                
                setTimeout(() => {
                  document.getElementById(`cart${i}`).textContent = 'Add to Cart';
                
            }, 1000);
                
                
               
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        function addtowish(prodname,email,i)
            {
              if (!email) {
    Swal.fire({
        title: 'Login to Purchase',
        text: 'To make a purchase, please log in.',
        icon: 'info',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Login'
    }).then((result) => {
        if (result.isConfirmed) {
            
            window.location.href = '/login';
        }
    });
}
               
           
            fetch(`/productaddtowishlist?name=${prodname}&email=${email}`, {
            method: 'POST', // Use POST or PATCH for updating data
            headers: {
            'Content-Type': 'application/json',
             },
        
    }).then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            // You can handle the response if needed
            return response.json();
        })
        .then(data => {
            // Update the button text and class
            
            if(data.success==true)
            {
              document.getElementById(`wish${i}`).textContent = 'Added to Wishlist';
            
            setTimeout(() => {
              document.getElementById(`wish${i}`).textContent = 'Add to Wishilist';
            
        }, 1000);
            }

            else{
              document.getElementById(`wish${i}`).textContent = 'Already added';
            
            setTimeout(() => {
              document.getElementById(`wish${i}`).textContent = 'Add to Wishilist';
            
        }, 1000);
            }
           
            
            
           
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
    $(document).ready(function () {
        $(".intro-slider").owlCarousel({
            items: 1,
            autoplay: true, 
            autoplayTimeout: 5000, // Autoplay interval in milliseconds (e.g., 10 seconds)
            loop: true, // Infinite loop
            nav: true, // Navigation buttons
            navText: ["<span class='icon-angle-left'></span>", "<span class='icon-angle-right'></span>"], // Custom navigation icons
            dots: false
            
        });
    });
    

        </script>

            <%- include('../layouts/footer') %>
            <%- include('../layouts/Login/LoginMob') %>
   